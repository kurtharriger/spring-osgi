<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<xsd:schema xmlns="http://www.springframework.org/schema/osgi"
            xmlns:xsd="http://www.w3.org/2001/XMLSchema"
            xmlns:beans="http://www.springframework.org/schema/beans"
            targetNamespace="http://www.springframework.org/schema/osgi"
            elementFormDefault="qualified"
            attributeFormDefault="unqualified">

	<xsd:import namespace="http://www.springframework.org/schema/beans"/>

	<!-- bean -->
	<xsd:element name="bean" type="Tbean"/>

	<xsd:complexType name="Tbean">
		<xsd:complexContent>
			<xsd:extension base="beans:identifiedType">
				<xsd:attribute name="application-context" use="required" type="xsd:string"/>
				<xsd:attribute name="retry-times" use="optional" type="xsd:int" default="2"/>
				<xsd:attribute name="retry-delay-ms" use="optional" type="xsd:int" default="1000"/>
			</xsd:extension>
		</xsd:complexContent>
	</xsd:complexType>

	<!-- reference -->
	<xsd:element name="reference" type="Treference"/>

	<xsd:complexType name="Treference">
		<xsd:complexContent>
			<xsd:extension base="beans:identifiedType">
				<xsd:sequence>
					<xsd:element name="property" type="beans:propertyType" minOccurs="0" maxOccurs="unbounded"/>
				</xsd:sequence>
				<xsd:attribute name="interface" use="required" type="xsd:string"/>
				<xsd:attribute name="bean-name" use="optional" type="xsd:string"/>
				<xsd:attribute name="target" use="optional" type="xsd:string"/>
				<xsd:attribute name="cardinality" use="optional" type="Tcardinality" default="1..1"/>
				<xsd:attribute name="broadcast" use="optional" type="xsd:boolean" default="false"/>
				<xsd:attribute name="result-summarizer" use="optional" type="xsd:string"/>
				<xsd:attribute name="retry-times" use="optional" type="xsd:int" default="2"/>
				<xsd:attribute name="retry-delay-ms" use="optional" type="xsd:int" default="1000"/>
				<xsd:attribute name="depends-on" type="xsd:string" use="optional"/>
				<xsd:attribute name="push-bundle-as-context-classloader" type="xsd:boolean" default="false"/>
				<xsd:attribute name="listeners" type="xsd:string" use="optional"/>
			</xsd:extension>
		</xsd:complexContent>
	</xsd:complexType>

	<xsd:simpleType name="Tcardinality">
		<xsd:restriction base="xsd:string">
			<xsd:enumeration value="0..1"/>
			<xsd:enumeration value="0..n"/>
			<xsd:enumeration value="1..1"/>
			<xsd:enumeration value="1..n"/>
		</xsd:restriction>
	</xsd:simpleType>

	<!-- service -->
	<xsd:element name="service" type="Tservice"/>

	<xsd:complexType name="Tservice">
		<xsd:all>
			<xsd:element name="service-properties" type="beans:propsType" minOccurs="0"/>
			<xsd:element name="interfaces" type="beans:listOrSetType" minOccurs="0"/>
		</xsd:all>
		<xsd:attribute name="id" type="xsd:string" use="required"/>
		<xsd:attribute name="ref" type="xsd:string" use="required"/>
		<xsd:attribute name="interface" type="xsd:string" use="optional"/>
		<xsd:attribute name="lazy-init" type="xsd:boolean" use="optional" default="false"/>
		<xsd:attribute name="depends-on" type="xsd:string" use="optional"/>
		<xsd:attribute name="activation-method" type="xsd:string" use="optional"/>
		<xsd:attribute name="deactivation-method" type="xsd:string" use="optional"/>
	</xsd:complexType>

	<xsd:complexType name="TserviceProperty">
		<xsd:attribute name="name" type="xsd:string" use="required"/>
		<xsd:attribute name="value" type="xsd:string" use="required"/>
	</xsd:complexType>

	<!-- property placeholder -->
	<xsd:element name="property-placeholder" type="TpropertyPlaceholder"/>

	<xsd:complexType name="TpropertyPlaceholder">
		<xsd:attribute name="persistent-id" type="xsd:string" use="required"/>
		<xsd:attribute name="placeholder-prefix" type="xsd:string" use="optional" default="${"/>
		<xsd:attribute name="placeholder-suffix" type="xsd:string" use="optional" default="}"/>
	</xsd:complexType>

	<!-- bundle -->
	<xsd:element name="bundle" type="Tbundle"/>

	<xsd:complexType name="Tbundle">
		<xsd:complexContent>
			<xsd:extension base="beans:identifiedType">
				<xsd:attribute name="symbolic-name" type="xsd:string" use="optional"/>
				<xsd:attribute name="depends-on" type="xsd:string" use="optional"/>
				<xsd:attribute name="location" type="xsd:string" use="optional"/>
				<xsd:attribute name="state" type="Tstate" use="optional"/>
				<xsd:attribute name="start-level" type="xsd:int" use="optional" default="0"/>
				<xsd:attribute name="push-bundle-as-context-classloader" type="xsd:boolean" default="false"/>
			</xsd:extension>
		</xsd:complexContent>
	</xsd:complexType>

	<xsd:simpleType name="Tstate">
		<xsd:restriction base="xsd:string">
			<xsd:enumeration value="start"/>
			<xsd:enumeration value="stop"/>
			<xsd:enumeration value="install"/>
			<xsd:enumeration value="uninstall"/>
			<xsd:enumeration value="update"/>
		</xsd:restriction>
	</xsd:simpleType>

	<!-- virtual-bundle -->
	<xsd:element name="virtual-bundle" type="TvirtualBundle"/>

	<xsd:complexType name="TvirtualBundle">
		<xsd:complexContent>
			<xsd:extension base="Tbundle">
				<xsd:all>
					<xsd:element name="imports" type="TpackageList" minOccurs="0"/>
					<xsd:element name="exports" type="TpackageList" minOccurs="0"/>
					<xsd:element name="dynamic-imports" type="TpackageList" minOccurs="0"/>
				</xsd:all>
				<xsd:attribute name="version" type="xsd:string" use="optional"/>
				<xsd:attribute name="group-id" type="xsd:string" use="optional"/>
				<xsd:attribute name="artifact-id" type="xsd:string" use="optional"/>
			</xsd:extension>
		</xsd:complexContent>
	</xsd:complexType>

	<xsd:complexType name="TpackageList">
		<xsd:sequence>
			<xsd:element name="package" type="Tpackage" minOccurs="0" maxOccurs="unbounded"/>
		</xsd:sequence>
	</xsd:complexType>

	<xsd:complexType name="Tpackage">
		<xsd:sequence>
			<xsd:element name="uses" type="TpackageList" minOccurs="0" maxOccurs="unbounded"/>
		</xsd:sequence>
		<xsd:attribute name="name" type="xsd:string" use="required"/>
		<xsd:attribute name="version" type="xsd:string" use="optional"/>
	</xsd:complexType>

	<!-- options -->
	<xsd:element name="config" type="Tconfig"/>

	<xsd:complexType name="Tconfig">
		<!-- context properties -->
		<xsd:sequence>
			<xsd:element name="context-aware-properties" type="TcontextAwareProperties"/>
		</xsd:sequence>
		<xsd:attribute name="push-bundle-as-context-classloader" type="xsd:boolean" default="false"/>
		<xsd:attribute name="honor-service-dependencies" type="xsd:boolean" default="true"/>
	</xsd:complexType>

	<xsd:complexType name="TcontextAwareProperties">
		<xsd:sequence>
			<xsd:element name="props" type="beans:propsType" minOccurs="0"/>
		</xsd:sequence>
	</xsd:complexType>

</xsd:schema>